<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <meta name="csrf-token" content="__CSRF_TOKEN__" /> <!-- Placeholder that will be replaced by server -->
    <title>AdiTeke Software Solutions - Innovative Software Development</title>
    <meta name="description" content="AdiTeke Software Solutions provides custom software development services including web development, mobile apps, AI solutions, and cloud services." />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      .gradient-bg {
        background: linear-gradient(110deg, #6366F1 0%, #10B981 100%);
      }
      .hero-pattern {
        background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      }
      .chatbot-container {
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body class="font-sans antialiased bg-background text-foreground">
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
    <!-- Production login redirect failsafe -->
    <script type="text/javascript" src="/role-redirect.js"></script>
    
    <!-- Production environment login redirection fix -->
    <script type="text/javascript">
      // Only run in production (not localhost)
      if (window.location.hostname !== 'localhost') {
        console.log("Production environment detected, adding safety redirects");
        
        // Handle URL-based redirection for logins
        const pathname = window.location.pathname;
        
        // Check if we're on a login page
        if (pathname.includes('/login/node-') || 
            pathname.includes('/login?role=') || 
            pathname.endsWith('/login')) {
          
          console.log("ðŸ”„ Login page detected in production");
          
          // Check localStorage for login status and target URL
          const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
          const targetRedirect = localStorage.getItem('targetRedirect');
          const userDataStr = localStorage.getItem('currentUser');
          
          if (isAuthenticated && userDataStr) {
            console.log("ðŸ“± User is authenticated, checking for redirect target");
            
            // Use the stored target redirect if available
            if (targetRedirect) {
              console.log("ðŸŽ¯ Using stored target redirect:", targetRedirect);
              setTimeout(() => {
                window.location.href = targetRedirect;
              }, 1000);
              return;
            }
            
            // Otherwise determine the dashboard based on user data
            try {
              const userData = JSON.parse(userDataStr);
              let dashboardUrl = '/dashboard';
              
              // Check roleId in numeric form
              const roleId = typeof userData.roleId === 'string' 
                ? parseInt(userData.roleId) 
                : (typeof userData.roleId === 'number' ? userData.roleId : null);
                
              if (roleId === 1002) {
                dashboardUrl = '/admin/dashboard';
              } else if (roleId === 1000) {
                dashboardUrl = '/manager/dashboard';
              } else if (roleId === 1001) {
                dashboardUrl = '/client/dashboard';
              } else if (userData.username) {
                // Fallback to username check
                const username = userData.username.toLowerCase();
                if (username.includes('admin')) {
                  dashboardUrl = '/admin/dashboard';
                } else if (username.includes('manager')) {
                  dashboardUrl = '/manager/dashboard';
                } else if (username.includes('client')) {
                  dashboardUrl = '/client/dashboard';
                }
              }
              
              console.log("ðŸšª Redirecting to dashboard:", dashboardUrl);
              setTimeout(() => {
                window.location.href = dashboardUrl;
              }, 1000);
            } catch (e) {
              console.error("Error parsing user data:", e);
            }
          }
        }
        
        // Handle dedicated role-specific login pages
        const roleLoginPages = {
          '/login/node-admin': '/admin/dashboard',
          '/login/node-manager': '/manager/dashboard', 
          '/login/node-client': '/client/dashboard'
        };
        
        // Direct production fix for role-specific login pages
        Object.keys(roleLoginPages).forEach(loginPath => {
          if (pathname.includes(loginPath)) {
            console.log(`ðŸ“Œ Special login page match: ${loginPath} -> ${roleLoginPages[loginPath]}`);
            
            // Check if the user has successfully logged in
            const isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
            const userDataStr = localStorage.getItem('currentUser');
            
            if (isAuthenticated && userDataStr) {
              console.log("ðŸ‘¤ User authenticated, redirecting to role dashboard");
              setTimeout(() => {
                window.location.href = roleLoginPages[loginPath];
              }, 1000);
            }
          }
        });
      }
    </script>
  </body>
</html>
